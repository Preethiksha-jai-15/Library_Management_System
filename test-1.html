<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Library Search</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
  <style>
    .srch-style { padding: 8px; }
    .srch-icon-style { margin-left: -30px; }
    .filter-tag {
      display: inline-block;
      background-color: #d1ecf1;
      border: 1px solid #bee5eb;
      padding: 4px 8px;
      margin: 2px;
      border-radius: 12px;
      font-size: 12px;
    }
    .dropdown-box {
      border: 1px solid #ccc;
      padding: 10px;
      background: #f9f9f9;
      margin: 10px auto;
      display: none;
    }
    .filter-group {
      display: flex;
      gap: 30px;
    }
    .filter-column ul {
      list-style: none;
      padding-left: 0;
    }
    .filter-column li {
      cursor: pointer;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
    <nav class="navbar navbar-expand-sm nav-pills navbar-bg justify-content-center ">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a href="dashboard.html" class="nav-link mr-2 nav-color" data-toggle="pills"><i class="fa fa-home ml-2 mr-2" aria-hidden="true"></i>Home</a>
            </li>
            <li class="nav-item">
                <a href="favorites.html" class="nav-link mr-2 nav-color"><i class="fa fa-heart ml-2 mr-2" aria-hidden="true"></i>Favorites</a>              
            </li>
            <li class="nav-item">
                <a href="saved.html" class="nav-link mr-2 nav-color"><i class="fa fa-bookmark ml-2 mr-2" aria-hidden="true"></i>Saved</a>
            </li>
            <li class="nav-item">
                <a href="search.html" class="nav-link mr-2 nav-color"><i class="fa fa-search ml-2 mr-2" aria-hidden="true"></i>Search</a>            </li>
            <li class="nav-item">
                <a href="history.html" class="nav-link mr-2 nav-color"><i class="fa fa-history ml-2 mr-2" aria-hidden="true"></i>History</a>
            </li>
            <li><i class="fa fa-user-circle nav-link nav-color place icon-hover" aria-hidden="true"></i></li>
        </ul>
    </nav>
    
  <!-- Search Bar and Buttons -->
  <div class="form-inline justify-content-center mb-3">
    <input class="form-control srch-style" id="searchInput" type="text" placeholder="Search by book name">
    <i class="fa fa-search srch-icon-style" aria-hidden="true" style="cursor:pointer"></i>
    <button type="button" class="btn btn-success btn-sm" onclick="saveSelected('saved')">SAVE</button>
    <button type="button" class="btn btn-danger btn-sm" onclick="saveSelected('favorites')">FAVORITES</button>
  </div>

  <!-- Filters -->
  <div class="dropdown dropdown-box" id="filterDropdown">
    <div class="filter-group">
      <div class="filter-column">
        <strong><h6>Genre</h6></strong>
        <ul>
          <li onclick="selectFilter('Genre', 'Fiction')">Fiction</li>
          <li onclick="selectFilter('Genre', 'Romance')">Romance</li>
          <li onclick="selectFilter('Genre', 'Biography')">Biography</li>
          <li onclick="selectFilter('Genre', 'Adventure')">Adventure</li>
        </ul>
      </div>
      <div class="filter-column">
        <strong><h6>Language</h6></strong>
        <ul>
          <li onclick="selectFilter('Language', 'English')">English</li>
          <li onclick="selectFilter('Language', 'German')">German</li>
          <li onclick="selectFilter('Language', 'French')">French</li>
        </ul>
      </div>
      <div id="selectedFiltersBox" style="margin-left:auto"></div>
    </div>
    <button class="btn btn-info btn-sm mt-2">Search</button>
  </div>

  <!-- Book Table -->
  <table class="table table-bordered" border="1" cellpadding="10" cellspacing="0">
    <thead>
      <tr>
        <th>Select</th>
        <th>Book No.</th>
        <th>Title</th>
        <th>Genre</th>
        <th>Language</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="checkbox"></td>
        <td>B001</td>
        <td>Jane Eyre</td>
        <td>Romance</td>
        <td>English</td>
      </tr>
      <tr>
        <td><input type="checkbox"></td>
        <td>B002</td>
        <td>Mein Kampf</td>
        <td>Biography</td>
        <td>German</td>
      </tr>
      <tr>
        <td><input type="checkbox"></td>
        <td>B003</td>
        <td>Le Comte de Monte-Cristo</td>
        <td>Adventure</td>
        <td>French</td>
      </tr>
      <tr>
        <td><input type="checkbox"></td>
        <td>B004</td>
        <td>The Hobbit</td>
        <td>Fiction</td>
        <td>English</td>
      </tr>
    </tbody>
  </table>

  <!-- SCRIPT -->
  <script>
    let selectedFilters = [];

    function selectFilter(category, value) {
      const key = `${category}:${value}`;
      if (!selectedFilters.includes(key)) {
        selectedFilters.push(key);
        updateSelectedFilters();
      }
    }

    function removeFilter(index) {
      selectedFilters.splice(index, 1);
      updateSelectedFilters();
      applyFilters();
    }

    function updateSelectedFilters() {
      const container = document.getElementById("selectedFiltersBox");
      container.innerHTML = "";
      selectedFilters.forEach((item, index) => {
        const [category, value] = item.split(":");
        const tag = document.createElement("div");
        tag.className = "filter-tag";
        tag.innerHTML = `${value} <span style="cursor:pointer;" onclick="removeFilter(${index});">&times;</span>`;
        container.appendChild(tag);
      });
    }

    function applyFilters() {
      const input = document.getElementById("searchInput").value.trim().toLowerCase();
      const rows = document.querySelectorAll("table tbody tr");

      const noSearch = input === "";
      const noFilters = selectedFilters.length === 0;

      rows.forEach(row => {
        const title = row.children[2].textContent.trim().toLowerCase();
        const genre = row.children[3].textContent.trim().toLowerCase();
        const language = row.children[4].textContent.trim().toLowerCase();

        let matchesSearch = noSearch || title.includes(input);

        let matchesFilters = true;
        selectedFilters.forEach(filter => {
          const [cat, val] = filter.split(":");
          if (cat === "Genre" && !genre.includes(val.toLowerCase())) matchesFilters = false;
          if (cat === "Language" && !language.includes(val.toLowerCase())) matchesFilters = false;
        });

        row.style.display = matchesSearch && matchesFilters ? "" : "none";
      });
    }

    function saveSelected(type) {
      const selectedBooks = [];
      const checkboxes = document.querySelectorAll("table tbody input[type='checkbox']");
      checkboxes.forEach(checkbox => {
        if (checkbox.checked) {
          const row = checkbox.closest("tr");
          const book = {
            bookNo: row.children[1].textContent.trim(),
            title: row.children[2].textContent.trim()
          };
          selectedBooks.push(book);
        }
      });

      if (selectedBooks.length > 0) {
        let existing = JSON.parse(localStorage.getItem(type)) || [];
        existing = [...existing, ...selectedBooks];
        localStorage.setItem(type, JSON.stringify(existing));
        alert(`✅ Added ${selectedBooks.length} book(s) to ${type}`);
      } else {
        alert("⚠️ No books selected");
      }
    }

    const searchInput = document.getElementById("searchInput");
    const searchIcon = document.querySelector(".fa-search");
    const filterDropdown = document.getElementById("filterDropdown");

    searchInput.addEventListener("focus", () => {
      filterDropdown.style.display = "block";
    });

    document.addEventListener("click", function (event) {
      if (!filterDropdown.contains(event.target) && !searchInput.contains(event.target)) {
        filterDropdown.style.display = "none";
      }
    });

    searchIcon.addEventListener("click", applyFilters);
    document.querySelector("#filterDropdown button.btn-info").addEventListener("click", applyFilters);
  </script>

</body>
</html>
